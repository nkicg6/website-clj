<div id="edn">
{:title "Static clojure site part 2: images and links" :date "2018-08-07" :tags (clojure)}
</div>

<div id="outline-container-org7bb2a8c" class="outline-2">
<h2 id="org7bb2a8c">Part 2: Images and links</h2>
<div class="outline-text-2" id="text-org7bb2a8c">
</div><div id="outline-container-orgd30c092" class="outline-3">
<h3 id="orgd30c092">Images and relative links</h3>
<div class="outline-text-3" id="text-orgd30c092">
</div><div id="outline-container-org9b08d66" class="outline-4">
<h4 id="org9b08d66">Images</h4>
<div class="outline-text-4" id="text-org9b08d66">
<p>
Adding images is important to any site, and links too for that matter. How well do they work in this format?<br />
I'll start with a sample screenshot of my part of my landing page with an annotation.<br />
The first thing I did was make a new directory in my <code>resources/</code> directory called <code>public</code>, which will contain <code>img</code>, <code>css</code>, and <code>js</code> directories. The directory structure now looks like this:<br />
</p>
<pre class="example">
resources/
├── home
├── md
├── partials
├── posts
└── public
    ├── css
    ├── img
    └── js
</pre>

<p>
Now I will test it by adding a simple html tag for image to the source for my langing page.<br />
</p>

<pre class="example">
&lt;h1&gt;This is the landing page&lt;/h1&gt;
&lt;p&gt;
 Welcome to it.

Here is a test image:

 &lt;img src="../public/img/sample-img.png" alt="sample img!" /&gt;
&lt;/p&gt;

</pre>

<p>
This doesnt work. Changing the source to <code>&lt;img src ="sample-img.png"/&gt;</code> and copying the image to the same folder as the landing page doesn't help&#x2026;<br />
</p>
</div>

<div id="outline-container-org891ba17" class="outline-5">
<h5 id="org891ba17">Optimus</h5>
<div class="outline-text-5" id="text-org891ba17">
<p>
Christian Johansen's blog post uses <code>optimus</code> to wrap static folders. I'll start by trying to serve bootstrap locally rather than linking to the CDN.<br />
I played around with this for a few hours yesterday and couldn't figure it out. I understood things reasonably well until <code>Optimus</code>, which doesn't make much sense to me because I do not have a background in web development so I really cant understand what it is doing or why it is doing it. This is likely because I did not spend much time with the docs, but they use a lot of web-jargon and I don't have the time or will to jump into that now.<br />
</p>

<p>
     Luckily, I explored Christian Johansen's website a little more and came across something that seemed quite useful (<a href="https://cjohansen.no/optimized-optimus-asset-paths-clojurescript/">here</a>). But I didn't make much progress with this.<br />
&#x2026;<br />
Finally, after a few hours today I figured out how to add links. My directory structure now looks like so:<br />
</p>
<pre class="example">
resources/
├── home
├── md
├── org-posts
├── partials
├── posts
└── public
    ├── css
    ├── img
    └── js

</pre>
<p>
images can be added by referring to them relative to public. For example:<br />
</p>
<pre class="example">
[:div.test [:img {:src "/img/test-img.png"}]] ; img test in the hiccup function layout-base-header
</pre>

<p>
inserts the image stored in public/img/test-img.png<br />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org96fc5e6" class="outline-3">
<h3 id="org96fc5e6">org-workflow: Handling images</h3>
<div class="outline-text-3" id="text-org96fc5e6">
<p>
Back to my original org-export example file, I'll add an image in org-markup manner.<br />
</p>

<pre class="example">
#+OPTIONS: \n:1 toc:nil num:0 todo:nil ^:{}
#+HTML_CONTAINER: div



=* This is a test post
Here is a test post and a link to an image. 


[[file:~/personal_projects/website-clj/resources/public/img/test-img.png]]

</pre>

<p>
Exporting this to html gives the following link structure in HTML:<br />
</p>

<pre class="example">
&lt;img src="img/test-img.png" alt="test-img.png" /&gt;
</pre>

<p>
Which doesn't render properly wont work when I export the static site. Since all images are referred to <code>/img/</code>, I think I can easily write a string replace in Clojure and put it in my <code>html-posts</code> function to fix this formatting.<br />
<i>Note</i><br />
I know that I could use <a href="https://github.com/cgrand/enlive">enlive</a> to do pretty much the same thing, but with how my current workflow is, I dont think it is even necessary. I will add that in if I need to, but for now I just dont seem to need it.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">main pages function. </span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #0000FF;">fn</span> <span style="color: #907373;">[</span>req<span style="color: #907373;">]</span> <span style="color: #907373;">(</span>layout-base-header req <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span>map #<span style="color: #907373;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">img"</span> <span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">/img"</span><span style="color: #907373;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this fixes links to images</span>
                    <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>


<p>
Now I can start up my server and check out the link formatting when I <code>view-source</code> on <code>http://localhost:3000/test_post</code>:<br />
</p>


<p>
<code>&lt;img src</code>"/img/test-img.png" alt="test-img.png" /&gt;=<br />
</p>

<p>
Perfect! I will factor out this function so it is more readable like so:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">format-images</span> <span style="color: #7388D6;">[</span>html<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> html #<span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">img"</span> <span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">/img"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">main pages function.</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #0000FF;">fn</span> <span style="color: #907373;">[</span>req<span style="color: #907373;">]</span> <span style="color: #907373;">(</span>layout-base-header req <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> format-images <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
I will likely need to add a similar helper when linking between pages in a post, but this <code>key value</code> handling of all the pages as simple html strings makes it very easy to add formatting fixes to my exported html pages. I am starting to feel the value and power of Clojure's emphasis on simplicity already&#x2013;very cool!<br />
</p>
</div>
</div>
</div>

<div id="outline-container-org9306ed8" class="outline-2">
<h2 id="org9306ed8">References</h2>
<div class="outline-text-2" id="text-org9306ed8">
<ul class="org-ul">
<li><a href="https://github.com/magnars/stasis">Stasis</a><br /></li>
<li><a href="https://github.com/magnars/optimus">Optimus links</a><br /></li>
<li><a href="https://github.com/ring-clojure/ring/wiki/Static-Resources">Ring static middleware</a><br /></li>
<li><a href="https://github.com/yokolet/hiccup-samples">hiccup samples</a><br /></li>
<li>Christian Johansen's post on Building static sites in Clojure with Stasis <a href="https://cjohansen.no/building-static-sites-in-clojure-with-stasis/">https://cjohansen.no/building-static-sites-in-clojure-with-stasis/</a><br />
<ul class="org-ul">
<li>handling links <a href="https://cjohansen.no/optimized-optimus-asset-paths-clojurescript/">https://cjohansen.no/optimized-optimus-asset-paths-clojurescript/</a><br /></li>
<li>Also his post here is similar with some (useful) differences <a href="https://github.com/cjohansen/cjohansen-no/blob/master/resources/md/building-static-sites-in-clojure-with-stasis.md">https://github.com/cjohansen/cjohansen-no/blob/master/resources/md/building-static-sites-in-clojure-with-stasis.md</a><br /></li>
</ul></li>
<li><a href="https://8thlight.com/blog/colin-jones/2010/12/05/clojure-libs-and-namespaces-require-use-import-and-ns.html">Clojure namespaces</a><br /></li>
<li>add more org-mode links!<br /></li>
</ul>
</div>
</div>
