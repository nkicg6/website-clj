<div id="edn">
{:title "What's left to do" :date "2018-08-08" :tags (clojure)}
</div>
<div id="outline-container-orgf58c0ae" class="outline-2">
<h2 id="orgf58c0ae">What's left to do?</h2>
<div class="outline-text-2" id="text-orgf58c0ae">
<ul class="org-ul">
<li>On the index page, automatically list all of the pages in whatever subfolder that index refers to.<br />
<ul class="org-ul">
<li>Add <a href="https://github.com/edn-format/edn">edn</a> metadata to the top of the every page, use this to assign a published date, title, and tags to the posts.<br /></li>
</ul></li>
<li>Add tracking with google analytics or <a href="https://matomo.org/">Matomo</a> (used by <a href="https://www.fsf.org/">FSF</a>)<br /></li>
<li>refactor code for increased simplicity<br /></li>
</ul>
</div>
<div id="outline-container-org3d2d30f" class="outline-4">
<h4 id="org3d2d30f">From old todo page</h4>
<div class="outline-text-4" id="text-org3d2d30f">
<p>
<b>TODO:</b><br />
</p>
<ol class="org-ol">
<li>Update, condense, and clean these docs.<br /></li>
<li>Set up publish commands (see bottom)<br /></li>
<li>Port over useful posts from old site<br /></li>
<li><a href="https://github.com/swannodette/enlive-tutorial">enlive</a> tutorial is worth looking at<br /></li>
<li>Tests!!<br /></li>
</ol>
</div>
</div>


<div id="outline-container-org3bf48cf" class="outline-3">
<h3 id="org3bf48cf">Goals for today (2018-08-04)</h3>
<div class="outline-text-3" id="text-org3bf48cf">
<ol class="org-ol">
<li>Re-factor code for increased simplicity. Add a namespace to process pages.<br /></li>
<li>List subfolder pages on index page.<br />
<ul class="org-ul">
<li>add edn metadata to fix names, links, etc.<br /></li>
</ul></li>
</ol>
</div>

<div id="outline-container-org8c05ec1" class="outline-4">
<h4 id="org8c05ec1">New namespace to process HTML</h4>
<div class="outline-text-4" id="text-org8c05ec1">
<p>
In the spirit of the <a href="https://www.youtube.com/watch?v=f84n5oFoZBc">Hammock driven development</a> I am going to re-think the code I am writing and make a plan for what exactly I want to do. First, of all, I want a way to process the text of pages independently without adding more little functions to this mess:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>base pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span>str base <span style="color: #BA36A5;">%</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>map #<span style="color: #907373;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #b39ddb; font-weight: bold;">(?&lt;!</span><span style="color: #008000;">index</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #907373;">)</span> <span style="color: #907373;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #0000FF;">fn</span> <span style="color: #907373;">[</span>req<span style="color: #907373;">]</span> <span style="color: #907373;">(</span>layout-base-header req <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> format-images <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #8D8D84;">;;</span><span style="color: #8D8D84; font-style: italic;">---- snip ---</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">get-pages</span> <span style="color: #7388D6;">[]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>merge-page-sources
   <span style="color: #909183;">{</span><span style="color: #006FE0;">:landing</span> <span style="color: #709870;">(</span>home-page <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/home"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:programming</span>  <span style="color: #709870;">(</span>html-pages <span style="color: #008000;">"/programming"</span> <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/programming"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:science</span> <span style="color: #709870;">(</span>html-pages <span style="color: #008000;">"/science"</span> <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/science"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:partials</span> <span style="color: #709870;">(</span>partial-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/partials"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:public</span> <span style="color: #709870;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/public"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #709870;">)</span><span style="color: #909183;">}</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">--- snip ---</span>

</pre>
</div>

<p>
While <code>html-pages</code> isn't that bad now, all the maps and anonymous functions are getting a bit dense for me, and I plan to do some more pre-processing so I think it would really be best to re-factor it now.<br />
I also have no idea what <code>partials</code> are for in my map in <code>get-pages</code> (just copied from the tutorial), so that should probably go too.<br />
</p>

<p>
So, first thing first, how do I break this up, and what should I spin off into the new namespace called <code>process-pages</code>?<br />
</p>

<p>
To deal with the second part, I moved all the functions that deal directly with html formatting to the <code>process-pages</code> namespace, this follows the rule that each namespace should do one thing. I'll have the main <code>web.clj</code> handle building and exporting, mostly with the <code>get-pages</code> and <code>export</code> functions, but it makes sense that the html formatting should happen elsewhere (along the same lines, I have export helper functions that I broke out into a namespace called <code>export-helpers</code>).<br />
</p>
</div>
</div>
<div id="outline-container-org4f21d06" class="outline-4">
<h4 id="org4f21d06">New namespace</h4>
<div class="outline-text-4" id="text-org4f21d06">
<p>
The declaration for this namespace looks like so:<br />
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">website-clj/process_pages.clj</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.process-pages</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.page</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html5<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.element</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">(</span>link-to image<span style="color: #709870;">)</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">only for testing?</span>
            <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
And the functions included here will be <code>html-pages</code>, <code>layout-base-header</code>, <code>format-images</code>, the other prepare pages functions <code>partial-pages</code>, and <code>home-page</code>. And any others I write.<br />
Now I just change <code>web.clj</code> to accept the new ns, and add the alias in front of any of the new functions<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;;</span><span style="color: #8D8D84; font-style: italic;">website-clj/web.clj</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.web</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.assets</span> <span style="color: #006FE0;">:as</span> assets<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.export</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.link</span> <span style="color: #006FE0;">:as</span> link<span style="color: #909183;">]</span> 
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.optimizations</span> <span style="color: #006FE0;">:as</span> optimizations<span style="color: #909183;">]</span>      
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.prime</span> <span style="color: #006FE0;">:as</span> optimus<span style="color: #909183;">]</span>                    
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.strategies</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>serve-live-assets<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.java.io</span> <span style="color: #006FE0;">:as</span> io<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">website-clj.export-helpers</span> <span style="color: #006FE0;">:as</span> helpers<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">my export helper namespace</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">website-clj.process-pages</span> <span style="color: #006FE0;">:as</span> process<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">process-pages namespace</span>


</pre>
</div>
</div>
</div>

<div id="outline-container-orge70a6d4" class="outline-4">
<h4 id="orge70a6d4">break up <code>html-pages</code></h4>
<div class="outline-text-4" id="text-orge70a6d4">
<p>
Now for the first part, I'll look closely at <code>html-pages</code> and see what the different parts do<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">main pages formatting function</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>base pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">zipmap</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #006FE0;">str</span> base <span style="color: #BA36A5;">%</span><span style="color: #709870;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">1</span>
               <span style="color: #709870;">(</span>map #<span style="color: #907373;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #b39ddb; font-weight: bold;">(?&lt;!</span><span style="color: #008000;">index</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #907373;">)</span> <span style="color: #907373;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">2</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #0000FF;">fn</span> <span style="color: #907373;">[</span>req<span style="color: #907373;">]</span> <span style="color: #907373;">(</span>layout-base-header req <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> format-images <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">3 </span>
          <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">4</span>

</pre>
</div>

<ol class="org-ol">
<li>concatenates the "base url" onto the page name keys. This allows me to add things like "programming/" to the base of pages in the programming directory, and "science/" to the base of pages in the science directory. So the<br /></li>
<li>removes .html from keys, which are the page names IF they don't start in index, which is for landing pages and needs .html.<br /></li>
<li>applies the header to the pages, and fixes image links.<br /></li>
<li>returns a map of page names and values of raw html for pages. however this is a bunch of lazy functions<br /></li>
</ol>

<p>
Really not too complicated. But to be more explicit, I'll make named functions to fix this.<br />
To deal with <code>1</code> and <code>2</code>, I'll make a function to perform those roles.<br />
The new function and its use in <code>html-pages</code> looks like so:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">fmt-page-names</span> <span style="color: #7388D6;">[</span>base name<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>str base <span style="color: #909183;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> name #<span style="color: #008000;">"</span><span style="color: #b39ddb; font-weight: bold;">(?&lt;!</span><span style="color: #008000;">index</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">takes care of 1 and 2!</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">main pages formatting function</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>base pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">zipmap</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>fmt-page-names base <span style="color: #BA36A5;">%</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">apply new fn</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #0000FF;">fn</span> <span style="color: #907373;">[</span>req<span style="color: #907373;">]</span> <span style="color: #907373;">(</span>layout-base-header req <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> 
               <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> format-images <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> 
          <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
Great. I am happy with that. I'll cross 1 and 2 off the list. Now the second part is beginning to format the html. Rather than doing all the formatting in one function, I'll have change my <code>format-images</code> function to <code>format-html</code> and then when I have any other html formatting to do to <i>all</i> the pages I can add another function to <code>format-html</code>, which will just take raw html and mess with it. For now, it will only have the format-images function.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">format images</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">format-images</span> <span style="color: #7388D6;">[</span>html<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> html #<span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">img"</span> <span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">/img"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">format-html</span> <span style="color: #7388D6;">[</span>html<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">-&gt;</span> html
      <span style="color: #909183;">(</span>format-images<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">other fns for html here</span>
  <span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">main pages formatting function</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>base pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">zipmap</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>fmt-page-names base <span style="color: #BA36A5;">%</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span> 
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #0000FF;">fn</span> <span style="color: #907373;">[</span>req<span style="color: #907373;">]</span> <span style="color: #907373;">(</span>layout-base-header req <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> 
               <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> format-html <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> 
          <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
I am a lot happier with this. I have reduced complexity in my code by breaking up the anonymous functions, and explicitly naming them. I also don't have to deal with adding more complexity to my main <code>html-pages</code> function for future html formatting. I can just add more functions to the <code>format-html</code> function and be done with it. This will make editing and adding stuff much easier and more straightforward. I am trying to be more concise using the threading macros <code>-&gt;</code> and <code>-&gt;&gt;</code>, which are explained really well <a href="https://cjohansen.no/clojure-to-die-for/">here</a>.<br />
</p>
</div>
</div>
</div>

<div id="outline-container-orgb73cec6" class="outline-3">
<h3 id="orgb73cec6">All about <code>edn</code> metadata</h3>
<div class="outline-text-3" id="text-orgb73cec6">
<ol class="org-ol">
<li>create names of pages based on <code>edn</code> metadata as opposed to just using the file names.<br /></li>
<li>make a list of page with links to them in reverse chronological order (dates from <code>edn</code> metadata) in the appropriate index home page (i.e. a list of programming pages in the programming folder (except index itself&#x2026;) to list in the programming index page, same for science&#x2026;)<br />
<ul class="org-ul">
<li>This will likely be done using enlive to add links to a special div tag placed in the index page body.<br /></li>
</ul></li>
<li>strip <code>edn</code> from the raw html.<br /></li>
</ol>


<p>
This will be done by a function that acts on the map returned by <code>html-pages</code>. I think that is the simplest way to do it.<br />
</p>
</div>
<div id="outline-container-org95ad330" class="outline-4">
<h4 id="org95ad330">Read <code>edn</code> metadata</h4>
<div class="outline-text-4" id="text-org95ad330">
<p>
So in order to use metadata to name, tag, and add dates to pages I'll use a combination of <a href="https://github.com/cgrand/enlive">enlive</a> and Clojure's <a href="https://clojuredocs.org/clojure.edn">edn</a> data format. I'll insert the <code>edn</code> tags at the top of the org mode page (in html tags so it exports) and then parse it using <code>enlive</code> and use this to rename and do all the other fancy stuff with the data. To work on this, I'll add some <code>edn</code> metadata to a test html page and start playing. First I need to add <code>enlive</code> to my <code>project.clj</code><br />
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">project.clj</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defproject</span> <span style="color: #006699;">website-clj</span> <span style="color: #008000;">"0.1.0-SNAPSHOT"</span>
  <span style="color: #006FE0;">:description</span> <span style="color: #008000;">"Personal website built with Clojure, Stasis, and Hiccup"</span>
  <span style="color: #006FE0;">:url</span> <span style="color: #008000;">"http://nickgeorge.net"</span>
  <span style="color: #006FE0;">:license</span> <span style="color: #7388D6;">{</span><span style="color: #006FE0;">:name</span> <span style="color: #008000;">"Eclipse Public License"</span>
            <span style="color: #006FE0;">:url</span> <span style="color: #008000;">"http://www.eclipse.org/legal/epl-v10.html"</span><span style="color: #7388D6;">}</span>
  <span style="color: #006FE0;">:dependencies</span> <span style="color: #7388D6;">[</span><span style="color: #909183;">[</span><span style="color: #6434A3;">org.clojure</span><span style="color: #333333; background-color: #FFFFFF;">/</span>clojure <span style="color: #008000;">"1.8.0"</span><span style="color: #909183;">]</span>
                 <span style="color: #909183;">[</span>stasis <span style="color: #008000;">"1.0.0"</span><span style="color: #909183;">]</span>
                 <span style="color: #909183;">[</span>ring <span style="color: #008000;">"1.2.1"</span><span style="color: #909183;">]</span>
                 <span style="color: #909183;">[</span>hiccup <span style="color: #008000;">"1.0.5"</span><span style="color: #909183;">]</span>
                 <span style="color: #909183;">[</span><span style="color: #6434A3;">me.raynes</span><span style="color: #333333; background-color: #FFFFFF;">/</span>cegdown <span style="color: #008000;">"0.1.1"</span><span style="color: #909183;">]</span>
                 <span style="color: #909183;">[</span>optimus <span style="color: #008000;">"0.14.2"</span><span style="color: #909183;">]</span>
                 <span style="color: #909183;">[</span>enlive <span style="color: #008000;">"1.1.6"</span><span style="color: #909183;">]</span><span style="color: #7388D6;">]</span>
  <span style="color: #006FE0;">:ring</span> <span style="color: #7388D6;">{</span><span style="color: #006FE0;">:handler</span> <span style="color: #6434A3;">website-clj.web</span><span style="color: #333333; background-color: #FFFFFF;">/</span>app<span style="color: #7388D6;">}</span>
  <span style="color: #006FE0;">:profiles</span> <span style="color: #7388D6;">{</span><span style="color: #006FE0;">:dev</span> <span style="color: #909183;">{</span><span style="color: #006FE0;">:plugins</span> <span style="color: #709870;">[</span><span style="color: #907373;">[</span>lein-ring <span style="color: #008000;">"0.8.10"</span><span style="color: #907373;">]</span><span style="color: #709870;">]</span><span style="color: #909183;">}</span><span style="color: #7388D6;">}</span>
  <span style="color: #006FE0;">:aliases</span> <span style="color: #7388D6;">{</span><span style="color: #008000;">"build-site"</span> <span style="color: #909183;">[</span><span style="color: #008000;">"run"</span> <span style="color: #008000;">"-m"</span> <span style="color: #008000;">"website-clj.web/export"</span><span style="color: #909183;">]</span><span style="color: #7388D6;">}</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
and then run <code>lein deps</code> at the command line. I'll go through this <a href="https://github.com/swannodette/enlive-tutorial">enlive tutorial</a> to figure out how to parse that portion of the page. My <code>test.org</code> doc looks like this:<br />
</p>

<pre class="example">
#+HTML: &lt;div class="edn"&gt;
#+HTML: {:title "renamed" :date 2018-08-05 :tags (clojure testing post)}
#+HTML: &lt;/div&gt;
#+OPTIONS: \n:1 toc:nil num:0 todo:nil ^:{}

=* Here is my test content=

and some code 

#+BEGIN_SRC clojure 
(test clj-code)
(def test-me "test string")
#+END_SRC

</pre>

<p>
As you can see in the header I added the <code>#+HTML</code> tags, which will export literally when I run <code>org-publish-project clj-site</code> I get this:<br />
</p>

<pre class="example">
&lt;div class="edn"&gt;
{:title "renamed" :date 2018-08-05 :tags (clojure testing post)}
&lt;/div&gt;

&lt;div id="outline-container-orgd13af6f" class="outline-2"&gt;
&lt;h2 id="orgd13af6f"&gt;Here is my test content&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgd13af6f"&gt;
&lt;p&gt;
and some code&lt;br /&gt;
&lt;/p&gt;

&lt;div class="org-src-container"&gt;
&lt;pre class="src src-clojure"&gt;&lt;span style="color: #707183;"&gt;(&lt;/span&gt;&lt;span style="color: #006FE0;"&gt;test&lt;/span&gt; clj-code&lt;span style="color: #707183;"&gt;)&lt;/span&gt;
&lt;span style="color: #707183;"&gt;(&lt;/span&gt;&lt;span style="color: #0000FF;"&gt;def&lt;/span&gt; &lt;span style="color: #BA36A5;"&gt;test-me&lt;/span&gt; &lt;span style="color: #036A07;"&gt;"test string"&lt;/span&gt;&lt;span style="color: #707183;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

</pre>

<p>
With the useful stuff at the top in the tag. I made a new test folder for this, and I moved the test.html there. So now, I'll read that in and start messing around.<br />
</p>

<p>
I am playing with this code at the bottom of my new <code>process-clj</code> namespace.<br />
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">get the test of your first page</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">test-pages</span> <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span>first <span style="color: #709870;">(</span>vals <span style="color: #907373;">(</span>html-pages <span style="color: #008000;">"/test"</span>
                                          <span style="color: #6276BA;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #008000;">""</span> <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
test-pages <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">=&gt; html for the page</span>
</pre>
</div>

<p>
The <code>first vals</code> from my <code>html-pages</code> function returns a function, and I just call it with an empty string to give me the html text and store it in <code>test-pages</code>. Now I am going to use <code>enlive</code> to scrape it and read the stuff under the <code>edn</code> class div to start manipulating my keys and links.<br />
This took some time, but eventually I figured out this code:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.process-pages</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.page</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html5<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.element</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">(</span>link-to image<span style="color: #709870;">)</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">net.cgrand.enlive-html</span> <span style="color: #006FE0;">:as</span> enlive<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">add enlive!</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">only for testing?</span>
            <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">--- snip ---</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">test-pages</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-snippet <span style="color: #909183;">(</span><span style="color: #709870;">(</span>first <span style="color: #907373;">(</span>vals <span style="color: #6276BA;">(</span>html-pages <span style="color: #008000;">"/test"</span>
                                                               <span style="color: #858580;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #008000;">""</span> <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">selected</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">select</span> test-pages <span style="color: #909183;">[</span><span style="color: #006FE0;">:#edn</span> <span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>text-node<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
selected
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">=&gt; "\n{</span><span style="color: #8D8D84; font-style: italic;">:title</span><span style="color: #8D8D84; font-style: italic;"> \"renamed\" </span><span style="color: #8D8D84; font-style: italic;">:date</span><span style="color: #8D8D84; font-style: italic;"> 2018-08-05 </span><span style="color: #8D8D84; font-style: italic;">:tags</span><span style="color: #8D8D84; font-style: italic;"> (clojure testing post)}\n"</span>
</pre>
</div>

<p>
Now I'll just read that in as a map using the clojure <code>edn</code> library.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.process-pages</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.page</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html5<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.element</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">(</span>link-to image<span style="color: #709870;">)</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">net.cgrand.enlive-html</span> <span style="color: #006FE0;">:as</span> enlive<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.edn</span> <span style="color: #006FE0;">:as</span> edn<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">require edn </span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">only for testing?</span>
            <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">--- snip ---</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">get the test of your first page</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">test-pages</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-snippet <span style="color: #909183;">(</span><span style="color: #709870;">(</span>first <span style="color: #907373;">(</span>vals <span style="color: #6276BA;">(</span>html-pages <span style="color: #008000;">"/test"</span>
                                                               <span style="color: #858580;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #008000;">""</span> <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">selected</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">select</span> test-pages <span style="color: #909183;">[</span><span style="color: #006FE0;">:#edn</span> <span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>text-node<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #6434A3;">edn</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">read-string</span> <span style="color: #7388D6;">(</span><span style="color: #006FE0;">apply</span> str selected<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">=&gt; {</span><span style="color: #8D8D84; font-style: italic;">:title</span><span style="color: #8D8D84; font-style: italic;"> "renamed" </span><span style="color: #8D8D84; font-style: italic;">:date</span><span style="color: #8D8D84; font-style: italic;"> "2018-08-05" </span><span style="color: #8D8D84; font-style: italic;">:tags</span><span style="color: #8D8D84; font-style: italic;"> ("clojure" "testing" "post")}</span>
</pre>
</div>

<p>
I refactored that into a function using the threading macro like so:<br />
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">test-html</span> <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span>first <span style="color: #709870;">(</span>vals <span style="color: #907373;">(</span>html-pages <span style="color: #008000;">"/test"</span>
                                         <span style="color: #6276BA;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #008000;">""</span> <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">parse-edn</span>
  <span style="color: #7388D6;">[</span>html<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">-&gt;</span> html
      <span style="color: #909183;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-snippet<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">select</span> <span style="color: #709870;">[</span><span style="color: #006FE0;">:#edn</span> <span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>text-node<span style="color: #709870;">]</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #0000FF;">-&gt;&gt;</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">apply</span> str<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">I know this is bad form, but it is the best way I know how to do it..</span>
      <span style="color: #909183;">(</span><span style="color: #6434A3;">edn</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">read-string</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>parse-edn test-html<span style="color: #707183;">)</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">=&gt; {</span><span style="color: #8D8D84; font-style: italic;">:title</span><span style="color: #8D8D84; font-style: italic;"> "renamed" </span><span style="color: #8D8D84; font-style: italic;">:date</span><span style="color: #8D8D84; font-style: italic;"> "2018-08-05" </span><span style="color: #8D8D84; font-style: italic;">:tags</span><span style="color: #8D8D84; font-style: italic;"> ("clojure" "testing" "post")}</span>
</pre>
</div>

<p>
Unfortunately, I need to use <code>(apply str html)</code>, with the html passed as the last argument. The <code>-&gt;</code> macro inserts the result of the previous form as the <i>first</i> argument, which would result in the apply step looking like <code>(apply html str)</code> which will not work. The <code>-&gt;&gt;</code> macro inserts the result of the previous form as the <i>last</i> argument, so added that macro to apply to only the <code>apply str</code> step. I've read mixing these macros is bad form, but for now it seems to work so I'll leave it be.<br />
</p>

<p>
I created another <code>test.html</code> page called <code>test2.html</code>, and I just tested to make sure I could map over it with <code>parse-edn</code>. You'll notice I had to use <code>prepare-pages</code> in order to force the functions to evaluate.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">prepare-page</span> <span style="color: #7388D6;">[</span>page<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">if</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">string?</span> page<span style="color: #909183;">)</span> page <span style="color: #909183;">(</span>page <span style="color: #008000;">""</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #006FE0;">map</span> parse-edn
     <span style="color: #7388D6;">(</span><span style="color: #006FE0;">map</span> prepare-page
          <span style="color: #909183;">(</span><span style="color: #006FE0;">vals</span>
           <span style="color: #709870;">(</span>html-pages <span style="color: #008000;">"/test"</span>
                       <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;;</span><span style="color: #8D8D84; font-style: italic;">=&gt;  [{</span><span style="color: #8D8D84; font-style: italic;">:title</span><span style="color: #8D8D84; font-style: italic;"> "renamed" </span><span style="color: #8D8D84; font-style: italic;">:date</span><span style="color: #8D8D84; font-style: italic;"> "2018-08-05" </span><span style="color: #8D8D84; font-style: italic;">:tags</span><span style="color: #8D8D84; font-style: italic;"> ("clojure" "testing" "post")} {</span><span style="color: #8D8D84; font-style: italic;">:title</span><span style="color: #8D8D84; font-style: italic;"> "renamed2" </span><span style="color: #8D8D84; font-style: italic;">:date</span><span style="color: #8D8D84; font-style: italic;"> "2018-08-06" </span><span style="color: #8D8D84; font-style: italic;">:tags</span><span style="color: #8D8D84; font-style: italic;"> ("clojure" "testing2" "post")}]</span>

</pre>
</div>

<p>
Now I made a few changes to <code>parse-edn</code> to get my link generator working quickly. Here is that updated function:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">--- snip ---</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">prepare-page</span> <span style="color: #7388D6;">[</span>page<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">if</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">string?</span> page<span style="color: #909183;">)</span> page <span style="color: #909183;">(</span>page <span style="color: #008000;">""</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">parse-edn</span>
  <span style="color: #7388D6;">[</span>html<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">-&gt;</span> html
      <span style="color: #909183;">(</span>prepare-page<span style="color: #909183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">new, render the page if a fn</span>
      <span style="color: #909183;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-snippet<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">select</span> <span style="color: #709870;">[</span><span style="color: #006FE0;">:#edn</span> <span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>text-node<span style="color: #709870;">]</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #0000FF;">-&gt;&gt;</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">apply</span> str<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">I know this is bad form, but it is the best way I know how to do it..</span>
      <span style="color: #909183;">(</span><span style="color: #6434A3;">edn</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">read-string</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #006FE0;">get</span> <span style="color: #006FE0;">:title</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">new just return the title for now. </span>
</pre>
</div>

<p>
I just added <code>prepare-page</code> in order to force render the functions, and the <code>(get :title)</code> to return just the title for now. However in my main <code>get-pages</code> function in <code>web.clj</code>, the index pages will be included. Since it would be silly to link to those in the link pages, I will filter those out with a regex. The final form to give me a <code>hash-map</code> of <code>{url-title metadata-title}</code> looks like this:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">remove-index</span> <span style="color: #7388D6;">[</span>values<span style="color: #7388D6;">]</span> <span style="color: #7388D6;">(</span><span style="color: #006FE0;">remove</span> #<span style="color: #909183;">(</span><span style="color: #006FE0;">re-matches</span> #<span style="color: #008000;">"</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">/.*/</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">?index</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">.html</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">?"</span> <span style="color: #BA36A5;">%</span><span style="color: #909183;">)</span> values<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">link-map</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">zipmap</span> <span style="color: #909183;">(</span>remove-index <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> test-map<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span>remove-index <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> parse-edn <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> test-map<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
I envision using this in a separate series of functions to create lists of urls for all my pages. Basically, this would be reduced to a single list of href links, which I would pass to a helper function out side of <code>get-pages</code>, which would then insert the list using enlive to the index pages <i>only</i> by using a unique div element. A skeleton looks like so:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">web.clj </span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">define links below</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">list-of-science-links</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>make-links science-map<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">list-of-programming-links</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>make-links programming-map<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">below, process/insert-links will add the links to index.html using enlive and a unique selector</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">get-pages</span> <span style="color: #7388D6;">[]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>merge-page-sources
   <span style="color: #909183;">{</span><span style="color: #006FE0;">:landing</span>  <span style="color: #709870;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>home-page <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/home"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:programming</span>  <span style="color: #709870;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>insert-links list-of-programming-links <span style="color: #907373;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-pages <span style="color: #008000;">"/programming"</span> <span style="color: #6276BA;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/programming"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">NEW!</span>
    <span style="color: #006FE0;">:science</span> <span style="color: #709870;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>insert-links list-of-science-links <span style="color: #907373;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-pages <span style="color: #008000;">"/science"</span> <span style="color: #6276BA;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/science"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">NEW</span>
    <span style="color: #006FE0;">:partials</span> <span style="color: #709870;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>partial-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/partials"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:public</span> <span style="color: #709870;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/public"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #709870;">)</span><span style="color: #909183;">}</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org96c6087" class="outline-3">
<h3 id="org96c6087">making links from page lists</h3>
<div class="outline-text-3" id="text-org96c6087">
<p>
So todo, I need to write a function to make a valid html link, then figure out how to add it to the index page.<br />
</p>

<p>
I'll start tackling these by first addressing the <code>process/make-links</code> problem.  First, I'll make <code>link-map</code>, defined in the previous section into a into a function<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">make a map for urls</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">link-map</span> <span style="color: #7388D6;">[</span>stasis-map<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">zipmap</span> <span style="color: #909183;">(</span>remove-index <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> stasis-map<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span>remove-index <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> parse-edn <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> stasis-map<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
Now generating links from these is shown with the following hiccup code (note I had to update my <code>ns</code>):<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.process-pages</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.core</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html<span style="color: #709870;">]</span><span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">just added</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.page</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html5<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.element</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">(</span>link-to image<span style="color: #709870;">)</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">net.cgrand.enlive-html</span> <span style="color: #006FE0;">:as</span> enlive<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.edn</span> <span style="color: #006FE0;">:as</span> edn<span style="color: #909183;">]</span> 
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">only for testing?</span>
            <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">--- snip ---</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">test-map</span> <span style="color: #7388D6;">(</span>html-pages <span style="color: #008000;">"/test"</span>
                          <span style="color: #909183;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">I'll work with the map that stasis returns</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">make a map for urls</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">link-map</span> <span style="color: #7388D6;">[</span>stasis-map<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">zipmap</span> <span style="color: #909183;">(</span>remove-index <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> stasis-map<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span>remove-index <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> parse-edn <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> stasis-map<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">removes index files form the maps. </span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this makes a list of links with Hiccup. enlive will then insert it.</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">link-list</span> <span style="color: #7388D6;">[</span>links<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>html <span style="color: #909183;">[</span><span style="color: #006FE0;">:ul</span> <span style="color: #709870;">(</span><span style="color: #0000FF;">for</span> <span style="color: #907373;">[</span><span style="color: #6276BA;">[</span>k v<span style="color: #6276BA;">]</span> links<span style="color: #907373;">]</span>
               <span style="color: #907373;">[</span><span style="color: #006FE0;">:li</span> <span style="color: #6276BA;">(</span>link-to k v<span style="color: #6276BA;">)</span><span style="color: #907373;">]</span><span style="color: #709870;">)</span><span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">returns the html for the list of links. </span>

<span style="color: #707183;">(</span>link-list <span style="color: #7388D6;">(</span>link-map test-map<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">demo how it will run.</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">=&gt; "&lt;ul&gt;&lt;li&gt;&lt;a href=\"/test/test\"&gt;renamed&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\"/test/test2\"&gt;renamed2&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;"</span>
</pre>
</div>

<p>
Great! Quick refactoring for simplicity:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">make-links</span> <span style="color: #7388D6;">[</span>stasis-map<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">-&gt;</span> stasis-map
      <span style="color: #909183;">(</span>link-map<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>link-list<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span>make-links test-map<span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;;</span><span style="color: #8D8D84; font-style: italic;">=&gt; "&lt;ul&gt;&lt;li&gt;&lt;a href=\"/test/test\"&gt;renamed&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\"/test/test2\"&gt;renamed2&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;"</span>
</pre>
</div>

<p>
Now I need to insert a new special <code>&lt;div&gt;</code> tag into my index html, then use enlive to insert these links!<br />
</p>
</div>
</div>

<div id="outline-container-org62545d2" class="outline-3">
<h3 id="org62545d2">Inserting <code>hiccup</code> html with <code>enlive</code></h3>
<div class="outline-text-3" id="text-org62545d2">
<p>
First, I wanted to make sure that I could hide the metadata from the normal page. I <i>could</i> use enlive to actually delete them, but that is really just unnecessary. I don't care if it is in the html, I'd just rather not show it. So I made a css file called <code>hide.css</code> and had it hide all the <code>id=edn</code> divs.<br />
</p>

<div class="org-src-container">
<pre class="src src-css"><span style="color: #0000ff; font-weight: bold;">#edn </span>{
    <span style="color: #00AA00;">display</span>: none;
}
</pre>
</div>

<p>
Easy. Now I will use the <code>include-css</code> hiccup header and add the following to my <code>hiccup</code>-defined header:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">process-pages ns</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.process-pages</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.core</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.page</span> <span style="color: #006FE0;">:use</span> <span style="color: #709870;">[</span>html5 include-css include-js<span style="color: #709870;">]</span><span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">include hiccup helpers</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.element</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">(</span>link-to image<span style="color: #709870;">)</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">net.cgrand.enlive-html</span> <span style="color: #006FE0;">:as</span> enlive<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.edn</span> <span style="color: #006FE0;">:as</span> edn<span style="color: #909183;">]</span> 
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">only for testing?</span>
            <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">--- snip ---</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">layout-base-header</span> <span style="color: #7388D6;">[</span>request page<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>html5
   <span style="color: #909183;">[</span><span style="color: #006FE0;">:head</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:meta</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:charset</span> <span style="color: #008000;">"utf-8"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #8D8D84;">;;</span><span style="color: #8D8D84; font-style: italic;">... --- snip ---</span>
    <span style="color: #709870;">(</span>include-css <span style="color: #008000;">"/css/hide.css"</span><span style="color: #709870;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">the new stuff</span>
    <span style="color: #8D8D84;">;;</span><span style="color: #8D8D84; font-style: italic;">... --- snip ---</span>
    <span style="color: #909183;">]</span>
   <span style="color: #8D8D84;">;;</span><span style="color: #8D8D84; font-style: italic;">Much more here, I cut it out for simplicity</span>
   <span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
Great, I can access all the elements of that like a normal hash-map now.<br />
The element I want to insert the links into is called<br />
</p>
<pre class="example">
&lt;div id="pageListDiv"&gt;Page nav list Here&lt;/div&gt; 
</pre>

<p>
Which will <i>only</i> exist in the index.html pages that should have this list.<br />
</p>
</div>

<div id="outline-container-org7a5588d" class="outline-4">
<h4 id="org7a5588d">adding links</h4>
<div class="outline-text-4" id="text-org7a5588d">
<p>
After a lot of troubleshooting, I finally came up with this.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">add-links</span> <span style="color: #7388D6;">[</span>page links<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">-&gt;</span> page
      <span style="color: #909183;">(</span>prepare-page<span style="color: #909183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">forse eval of lazy pages</span>
      <span style="color: #909183;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span>sniptest
       <span style="color: #709870;">[</span><span style="color: #006FE0;">:#pageListDiv</span><span style="color: #709870;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">exists only in index pages. </span>
       <span style="color: #709870;">(</span><span style="color: #6434A3;">enlive</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">content</span> links<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
This can be mapped over the values like so:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">used for testing</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">stasis-map</span> <span style="color: #7388D6;">(</span>html-pages <span style="color: #008000;">"/test"</span> <span style="color: #909183;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">test-html</span> <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #006FE0;">first</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">vals</span> stasis-map<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #008000;">""</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">test-links</span> <span style="color: #7388D6;">(</span>make-links <span style="color: #909183;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">map it!</span>

<span style="color: #707183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #7388D6;">(</span>add-links <span style="color: #BA36A5;">%</span> test-links<span style="color: #7388D6;">)</span>
     <span style="color: #7388D6;">(</span><span style="color: #006FE0;">vals</span> stasis-map<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
This seems to give the exact output I was looking for. Now when I refer to how it will actually be used:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">web.clj</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">--- snip ---</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">get-pages</span> <span style="color: #7388D6;">[]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>merge-page-sources
   <span style="color: #909183;">{</span><span style="color: #006FE0;">:landing</span> <span style="color: #709870;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>home-page <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/home"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:programming</span>  <span style="color: #709870;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-pages <span style="color: #008000;">"/programming"</span> <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/programming"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:science</span> <span style="color: #709870;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-pages <span style="color: #008000;">"/science"</span> <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/science"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:partials</span> <span style="color: #709870;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>partial-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/partials"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:public</span> <span style="color: #709870;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/public"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #709870;">)</span>

    <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">see below!</span>

    <span style="color: #006FE0;">:test</span> <span style="color: #709870;">(</span>zipmap <span style="color: #907373;">(</span>keys <span style="color: #6276BA;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-pages <span style="color: #008000;">"/test"</span> <span style="color: #858580;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
                  <span style="color: #907373;">(</span>map #<span style="color: #6276BA;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>add-links <span style="color: #BA36A5;">%</span> test-links<span style="color: #6276BA;">)</span> <span style="color: #6276BA;">(</span>vals <span style="color: #858580;">(</span><span style="color: #6434A3;">process</span><span style="color: #333333; background-color: #FFFFFF;">/</span>html-pages <span style="color: #008000;">"/test"</span> <span style="color: #80A880;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/test"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">}</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


</pre>
</div>
<p>
I still need to return a zipmap like html-pages does, but I also need to use enlive to insert the links.<br />
This technically does what I want, unfortunately all my <code>&gt;</code> characters are escaped as <code>&amp;gt</code>, so the html is not rendering as a list. I'll have to figure out why that is. It also appears the links are not perfectly correct in this one, they need the "test" prepended.<br />
</p>
</div>
</div>
</div>

<div id="outline-container-orga86cb18" class="outline-3">
<h3 id="orga86cb18">Goals for tomorrow (2018-08-06)</h3>
<div class="outline-text-3" id="text-orga86cb18">
<p>
I want to make a list of all non-index pages under a certain category (programming or science) and add them to the index page under the category in reverse chronological order. This will make navigation easier. To accomplish this, I'll build a new map by grabbing the <code>:title</code> from the parsed edn, and using it as a hash-map key with the value being the url for the article. Then I will iterate through those, and build a list of URLs to insert into the index page under some special div body tag.<br />
</p>
</div>
</div>
</div>
