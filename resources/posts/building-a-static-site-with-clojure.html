<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf94d304">Static sites</a></li>
<li><a href="#org5db5e5b">Why?</a>
<ul>
<li><a href="#orgab1f290">Why Clojure?</a></li>
<li><a href="#org57ddc8a">Why Stasis?</a></li>
</ul>
</li>
<li><a href="#org8d4c2ca">Org-mode to html workflow</a></li>
<li><a href="#org7aa8fec">Building the website</a>
<ul>
<li><a href="#orge3ec381">Style</a></li>
<li><a href="#org1ff106a">My header and footer</a></li>
<li><a href="#org7dbb018">org-workflow: basic HTML export</a></li>
<li><a href="#orgc686904">Images and relative links</a>
<ul>
<li><a href="#org7a30a32">Images</a>
<ul>
<li><a href="#orgca490da">Optimus</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2da4c7c">org-workflow: Handling images</a></li>
<li><a href="#orgb0bc528">org-workflow: syntax highlighting</a>
<ul>
<li><a href="#org9ed2460">Links</a></li>
</ul>
</li>
<li><a href="#orgcd73e37">publishing</a>
<ul>
<li><a href="#orgc82ba68">Hosting on Github Pages</a></li>
<li><a href="#orgc528355">one push publishing with Leiningen :alias</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2344fef">References</a></li>
</ul>
</div>
</div>
<p>
<b>TODO:</b><br />
</p>
<ol class="org-ol">
<li>Update, condense, and clean these docs.<br /></li>
<li>Set up publish commands (see bottom)<br /></li>
<li>Port over useful posts from old site<br /></li>
<li>Tests!!<br /></li>
</ol>

<div id="outline-container-orgf94d304" class="outline-2">
<h2 id="orgf94d304">Static sites</h2>
<div class="outline-text-2" id="text-orgf94d304">
<p>
These are static collections of HTML, CSS, and JavaScript files that make up simple, fast websites. The main difference between static sites and dynamic websites is that static sites do not fetch information from a database upon requests. They simply contain all the HTML, etc. files that make up the website.<br />
</p>
</div>
</div>
<div id="outline-container-org5db5e5b" class="outline-2">
<h2 id="org5db5e5b">Why?</h2>
<div class="outline-text-2" id="text-org5db5e5b">
<p>
They are simple and very useful. I don't need anything more complicated for my personal website, and static sites are low maintenance and easy to customize and extend.<br />
</p>
</div>
<div id="outline-container-orgab1f290" class="outline-3">
<h3 id="orgab1f290">Why Clojure?</h3>
<div class="outline-text-3" id="text-orgab1f290">
<p>
I am currently learning Clojure, mostly because I wanted to learn functional programming and Rich Hickey gives <a href="https://github.com/tallesl/Rich-Hickey-fanclub">amazing talks</a>, but also because it is an functional programming language hosted on both the web with clojurescript (javascript) and the JVM (regular Clojure). Since clojurescript is a clojure trans-piler for javascript, that means that I can use one language to leverage all of javascript and non-web programming or backend web tasks with clojure!<br />
</p>
</div>
</div>
<div id="outline-container-org57ddc8a" class="outline-3">
<h3 id="org57ddc8a">Why Stasis?</h3>
<div class="outline-text-3" id="text-org57ddc8a">
<p>
My original website was written with python and the Flask framework and made into a static site with <a href="https://pythonhosted.org/Frozen-Flask/">Frozen-flask</a> and <a href="https://pythonhosted.org/Flask-FlatPages/">Flask-FlatPages</a> for hosting on github pages. I was originally going to port it to Clojure using the Clojure static site generator <a href="https://github.com/cryogen-project/cryogen">Cryogen</a>, a clojure/clojurescript static website generator, but I found the templates hard to understand and customization difficult. In the spirit of Clojure (and Tim Ewald's excellent talk <a href="https://www.youtube.com/watch?v=ShEez0JkOFw">Programming with hand tools</a>), I choose to use the <a href="https://github.com/magnars/stasis">Stasis</a>, the clojure library for developing (frameworkless) static web sites. I will write about that in this post as I go.<br />
</p>
</div>
</div>
</div>

<div id="outline-container-org8d4c2ca" class="outline-2">
<h2 id="org8d4c2ca">Org-mode to html workflow</h2>
<div class="outline-text-2" id="text-org8d4c2ca">
<p>
<img src="file:///Users/Nick/personal_projects/website-clj/resources/public/img/org-mode-unicorn-logo.png" alt="org-mode-unicorn-logo.png" /><br />
  I write in Emacs with <a href="https://orgmode.org/">Org-mode</a> markup and plan to publish with Org-publish, so periodically I will be adding notes for how this all works with my org-mode publishing scheme. These will be under the sub heading <code>org-workflow</code> <br />
</p>
</div>
</div>

<div id="outline-container-org7aa8fec" class="outline-2">
<h2 id="org7aa8fec">Building the website</h2>
<div class="outline-text-2" id="text-org7aa8fec">
<p>
  <i>Disclaimer</i> <br />
I am still very new to Clojure, so my custom code will likely be very beginner-ish and rough, but hopefully it will improve as I go!<br />
 Christian Johansen's post on Building static sites in Clojure with Stasis <a href="https://cjohansen.no/building-static-sites-in-clojure-with-stasis/">https://cjohansen.no/building-static-sites-in-clojure-with-stasis/</a> <br />
</p>
</div>

<div id="outline-container-orge3ec381" class="outline-3">
<h3 id="orge3ec381">Style</h3>
<div class="outline-text-3" id="text-orge3ec381">
<p>
After following most of the Christian Johansen's awesome tutorial, the first thing I wanted to do was add <a href="https://getbootstrap.com/docs/3.3/getting-started/">Twitter Bootstrap</a> CSS. I know there is a <a href="https://github.com/weavejester/hiccup-bootstrap">Hiccup wrapper</a> for bootstrap, but since I write in Emacs Org-mode and export to HTML directly, I don't think it is necessary for me. Hiccup looks like simplified HTML, so I changed the name of the function from <code>layout-page</code> to <code>layout-base-header</code> and added the CDN links from the Bootstrap home page. The function now looks like this:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">layout-base-header</span> <span style="color: #7388D6;">[</span>page<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>html5
   <span style="color: #909183;">[</span><span style="color: #006FE0;">:head</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:meta</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:charset</span> <span style="color: #008000;">"utf-8"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:meta</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:name</span> <span style="color: #008000;">"viewport"</span>
            <span style="color: #006FE0;">:content</span> <span style="color: #008000;">"width=device-width, initial-scale=1.0"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:link</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:rel</span> <span style="color: #008000;">"stylesheet"</span> <span style="color: #006FE0;">:href</span> <span style="color: #008000;">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span style="color: #006FE0;">:integrity</span> <span style="color: #008000;">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span> <span style="color: #006FE0;">:crossorigin</span> <span style="color: #008000;">"anonymous"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:script</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:src</span> <span style="color: #008000;">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"</span> <span style="color: #006FE0;">:integrity</span> <span style="color: #008000;">"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"</span> <span style="color: #006FE0;">:crossorigin</span> <span style="color: #008000;">"anonymous"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span><span style="color: #909183;">]</span>
   <span style="color: #909183;">[</span><span style="color: #006FE0;">:body</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:div.logo</span> <span style="color: #008000;">"website-clj"</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:div.body</span> page<span style="color: #709870;">]</span><span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
This seems to work great for my <code>.md</code> rendered page, but the base page didn't inherit this styling. Looking through the functions I copied from the tutorial, I am betting it is due to the <code>get-pages</code> function. When it declares the <code>:public</code> map, it doesn't wrap the <code>stasis/slurp-directory</code> call in another function. I assume this just renders them raw. So I will modify <code>markdown-pages</code> function for HTML pages to see if this takes care of it.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">markdown-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">md$"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>layout-base-header <span style="color: #907373;">(</span><span style="color: #6434A3;">md</span><span style="color: #333333; background-color: #FFFFFF;">/</span>to-html <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>layout-base-header <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
and then I will change <code>get-pages</code> to add this function.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">get-pages</span> <span style="color: #7388D6;">[]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>merge-page-sources
   <span style="color: #909183;">{</span><span style="color: #006FE0;">:public</span> <span style="color: #709870;">(</span>html-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/public"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:partials</span> <span style="color: #709870;">(</span>partial-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/partials"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:markdown</span> <span style="color: #709870;">(</span>markdown-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/md"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">md$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">}</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>
<p>
But when I refreshed my webpage, I got this horrible error:<br />
</p>

<pre class="example">
1. Unhandled java.lang.IllegalArgumentException
   Don't know how to create ISeq from: clojure.core$map$fn__4781
...
</pre>

<p>
and on and on. Well, looks like I have to figure out what these functions are actually doing.<br />
</p>

<p>
First, I'll run one that I know works to see what the output looks like:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>markdown-pages <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/md"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">md$"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<pre class="example">
[ "/my-first-md" "&lt;!DOCTYPE html&gt;\n&lt;html&gt;&lt;head&gt;&lt;meta charset=\"utf-8\"&gt;&lt;meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"&gt;&lt;link crossorigin=\"anonymous\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" rel=\"stylesheet\"&gt;&lt;script crossorigin=\"anonymous\" integrity=\"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa\" src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=\"logo\"&gt;website-clj&lt;/div&gt;&lt;div class=\"body\"&gt;&lt;h1&gt;first md post&lt;/h1&gt;&lt;p&gt;Short for now&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;" ]

</pre>

<p>
Cool. but running the following fails:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>html-pages <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/public"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<pre class="example">
1. Unhandled java.lang.IllegalArgumentException
   Don't know how to create ISeq from: clojure.core$map$fn__4781
...
</pre>

<p>
That tells me we are returning a function. And now I see we obviously are with the bottom <code>map</code> function! <code>#()</code> is an anonymous function, so I need to add the argument <code>%</code>!<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>layout-base-header <span style="color: #BA36A5;">%</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">test</span>
<span style="color: #707183;">(</span>html-pages <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/public"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<pre class="example">
[ "/index" "&lt;!DOCTYPE html&gt;\n&lt;html&gt;&lt;head&gt;&lt;meta charset=\"utf-8\"&gt;&lt;meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"&gt;&lt;link crossorigin=\"anonymous\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" rel=\"stylesheet\"&gt;&lt;script crossorigin=\"anonymous\" integrity=\"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa\" src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=\"logo\"&gt;website-clj&lt;/div&gt;&lt;div class=\"body\"&gt;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;My blog&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;My blog&lt;/h1&gt;\n    &lt;p&gt;\n      Welcome to it.\n    &lt;/p&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;" ]

</pre>

<p>
Excellent! Now I will start the app up again and see what happens.<br />
</p>

<p>
weird! The landing page can't find it.<br />
<img src="img/not-found-index.png" alt="not-found-index.png" /><br />
</p>


<p>
But when I navigate to <code>/index</code>, it is right there and working.<br />
</p>


<div class="figure">
<p><img src="img/working-index.png" alt="working-index.png" /><br />
</p>
</div>

<p>
hmm, I will have to see how the home page will be rendered. When I return to Christian's blog, and re-read the explanation of <code>get-pages</code>, I see the only thing I changed was replacing the .html with a blank string. When i make the following change to the <code>html-pages</code> file, it works fine!<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">".html"</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>layout-base-header <span style="color: #BA36A5;">%</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


</pre>
</div>

<p>
Cool! so I will make a new folder called "home", and rename the folder "public" to "posts" so that it makes sense for me. After fixing the directory structure, my resources file looks like this:<br />
</p>

<pre class="example">
resources/
├── home
│   └── index.html
├── md
│   └── my-first-md.md
├── partials
│   └── about.html
└── posts
    └── test-post.html
</pre>

<p>
I then added a <code>home-page</code> function and modified <code>get-pages</code> to properly render. The relevant code (all of it) looks like this now:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.web</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.java.io</span> <span style="color: #006FE0;">:as</span> io<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.page</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html5<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">me.raynes.cegdown</span> <span style="color: #006FE0;">:as</span> md<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>




<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">layout-base-header</span> <span style="color: #7388D6;">[</span>page<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>html5
   <span style="color: #909183;">[</span><span style="color: #006FE0;">:head</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:meta</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:charset</span> <span style="color: #008000;">"utf-8"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:meta</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:name</span> <span style="color: #008000;">"viewport"</span>
            <span style="color: #006FE0;">:content</span> <span style="color: #008000;">"width=device-width, initial-scale=1.0"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:link</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:rel</span> <span style="color: #008000;">"stylesheet"</span> <span style="color: #006FE0;">:href</span> <span style="color: #008000;">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span style="color: #006FE0;">:integrity</span> <span style="color: #008000;">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span> <span style="color: #006FE0;">:crossorigin</span> <span style="color: #008000;">"anonymous"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:script</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:src</span> <span style="color: #008000;">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"</span> <span style="color: #006FE0;">:integrity</span> <span style="color: #008000;">"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"</span> <span style="color: #006FE0;">:crossorigin</span> <span style="color: #008000;">"anonymous"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span><span style="color: #909183;">]</span>
   <span style="color: #909183;">[</span><span style="color: #006FE0;">:body</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:div.logo</span> <span style="color: #008000;">"website-clj"</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:div.body</span> page<span style="color: #709870;">]</span><span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">pegdown-options</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">https://github.com/sirthias/pegdown</span>
  <span style="color: #7388D6;">[</span><span style="color: #006FE0;">:autolinks</span> <span style="color: #006FE0;">:fenced-code-blocks</span> <span style="color: #006FE0;">:strikethrough</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">markdown-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">md$"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>layout-base-header <span style="color: #907373;">(</span><span style="color: #6434A3;">md</span><span style="color: #333333; background-color: #FFFFFF;">/</span>to-html <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>layout-base-header <span style="color: #BA36A5;">%</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">partial-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">zipmap</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> layout-base-header <span style="color: #709870;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">home-page</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">zipmap</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span>layout-base-header <span style="color: #BA36A5;">%</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>home-page <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/home"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">get-pages</span> <span style="color: #7388D6;">[]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>merge-page-sources
   <span style="color: #909183;">{</span><span style="color: #006FE0;">:landing</span> <span style="color: #709870;">(</span>home-page <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/home"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #b39ddb; font-weight: bold;">(</span><span style="color: #008000;">html</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #b39ddb; font-weight: bold;">|</span><span style="color: #008000;">js</span><span style="color: #b39ddb; font-weight: bold;">)</span><span style="color: #008000;">$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:posts</span>  <span style="color: #709870;">(</span>html-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/posts"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:partials</span> <span style="color: #709870;">(</span>partial-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/partials"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #006FE0;">:markdown</span> <span style="color: #709870;">(</span>markdown-pages <span style="color: #907373;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>slurp-directory <span style="color: #008000;">"resources/md"</span> #<span style="color: #008000;">".*</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">md$"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">}</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">app</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>serve-pages get-pages<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
and the website is working now!<br />
</p>
</div>
</div>

<div id="outline-container-org1ff106a" class="outline-3">
<h3 id="org1ff106a">My header and footer</h3>
<div class="outline-text-3" id="text-org1ff106a">
<p>
On my old Python-flask based static blog, I made a nav bar that I really liked. The source looks like this:<br />
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000FF;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #006699;">html</span> <span style="color: #BA36A5;">lang</span>=<span style="color: #008000;">"en"</span>&gt;
    &lt;<span style="color: #006699;">head</span>&gt;

        &lt;<span style="color: #006699;">meta</span> <span style="color: #BA36A5;">charset</span>=<span style="color: #008000;">"utf-8"</span>&gt;
        &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Nicholas George</span>&lt;/<span style="color: #006699;">title</span>&gt;    
        &lt;<span style="color: #006699;">meta</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"viewport"</span> <span style="color: #BA36A5;">content</span>=<span style="color: #008000;">"width=device-width, initial-scale=1.0"</span>&gt;
        <span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;">link to bootstrap css </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;<span style="color: #006699;">link</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"/static/css/bootstrap.min.css"</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"stylesheet"</span>&gt;
        &lt;<span style="color: #006699;">link</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"stylesheet"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"</span>&gt;
    &lt;/<span style="color: #006699;">head</span>&gt;

    &lt;<span style="color: #006699;">body</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"font-size: 16px"</span>&gt;

        <span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;">navbar </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;<span style="color: #006699;">nav</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"navbar navbar-inverse"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container-fluid"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"navbar-header"</span>&gt;
                    &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"navbar-brand"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"/"</span>&gt; Nick George&lt;/<span style="color: #006699;">a</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
                &lt;<span style="color: #006699;">ul</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav navbar-nav navbar-right"</span>&gt;

                    &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"inactive"</span>&gt;&lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"/projects/"</span>&gt;Projects&lt;/<span style="color: #006699;">a</span>&gt;&lt;/<span style="color: #006699;">li</span>&gt;
                    &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"inactive"</span>&gt;&lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"/blog/"</span>&gt;Posts&lt;/<span style="color: #006699;">a</span>&gt;&lt;/<span style="color: #006699;">li</span>&gt;
                   &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"inactive"</span>&gt;&lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"/notes/"</span>&gt;Notes&lt;/<span style="color: #006699;">a</span>&gt;&lt;/<span style="color: #006699;">li</span>&gt; 
&lt;<span style="color: #006699;">li</span>&gt;
  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"https://github.com/nkicg6"</span>&gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"fa fa-github"</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"font-size:24px"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;

  &lt;/<span style="color: #006699;">a</span>&gt;
&lt;/<span style="color: #006699;">li</span>&gt;
&lt;<span style="color: #006699;">li</span>&gt;
  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"https://twitter.com/NicholasMG"</span>&gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"fa fa-twitter-square"</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"font-size:24px"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;

  &lt;/<span style="color: #006699;">a</span>&gt;
&lt;/<span style="color: #006699;">li</span>&gt;
                &lt;/<span style="color: #006699;">ul</span>&gt;                        

            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">nav</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;
<span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;">content goes here</span><span style="color: #8D8D84;">--&gt;</span>            


<span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;">footer </span><span style="color: #8D8D84;">--&gt;</span>
            &lt;<span style="color: #006699;">footer</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"footer"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"text-center"</span>&gt;
                    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"text-muted"</span>&gt;<span style="color: #BA36A5;">&amp;copy</span> 2017 Nicholas George&lt;/<span style="color: #006699;">span</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">footer</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;<span style="color: #006699;">script</span> <span style="color: #BA36A5;">data-cfasync</span>=<span style="color: #008000;">"false"</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"/cdn-cgi/scripts/f2bf09f8/cloudflare-static/email-decode.min.js"</span>&gt;&lt;/<span style="color: #006699;">script</span>&gt;&lt;/<span style="color: #006699;">body</span>&gt;
&lt;/<span style="color: #006699;">html</span>&gt;

</pre>
</div>

<p>
I'll translate that to hiccup and add it to my base. This was relatively straightforward to translate to hiccup. I just had to figure out the nested list structure, but once you do it isn't so bad.<br />
Here is my new <code>layout-base-header</code> function with the hiccup.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">layout-base-header</span> <span style="color: #7388D6;">[</span>page<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>html5
   <span style="color: #909183;">[</span><span style="color: #006FE0;">:head</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:meta</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:charset</span> <span style="color: #008000;">"utf-8"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:meta</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:name</span> <span style="color: #008000;">"viewport"</span>
            <span style="color: #006FE0;">:content</span> <span style="color: #008000;">"width=device-width, initial-scale=1.0"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:link</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:rel</span> <span style="color: #008000;">"stylesheet"</span> <span style="color: #006FE0;">:href</span> <span style="color: #008000;">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span style="color: #006FE0;">:integrity</span> <span style="color: #008000;">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span> <span style="color: #006FE0;">:crossorigin</span> <span style="color: #008000;">"anonymous"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:link</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:rel</span> <span style="color: #008000;">"stylesheet"</span> <span style="color: #006FE0;">:href</span> <span style="color: #008000;">"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:script</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:src</span> <span style="color: #008000;">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"</span> <span style="color: #006FE0;">:integrity</span> <span style="color: #008000;">"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"</span> <span style="color: #006FE0;">:crossorigin</span> <span style="color: #008000;">"anonymous"</span><span style="color: #907373;">}</span><span style="color: #709870;">]</span><span style="color: #909183;">]</span>
   <span style="color: #909183;">[</span><span style="color: #006FE0;">:body</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:nav</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"navbar navbar-inverse"</span><span style="color: #907373;">}</span>
     <span style="color: #907373;">[</span><span style="color: #006FE0;">:div</span> <span style="color: #6276BA;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"container-fluid"</span><span style="color: #6276BA;">}</span>
      <span style="color: #6276BA;">[</span><span style="color: #006FE0;">:div</span> <span style="color: #858580;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"navbar-header"</span><span style="color: #858580;">}</span>
       <span style="color: #858580;">(</span>link-to  <span style="color: #80A880;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"navbar-brand"</span><span style="color: #80A880;">}</span> <span style="color: #008000;">"/"</span> <span style="color: #008000;">"Nick George"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">]</span>
      <span style="color: #6276BA;">[</span><span style="color: #006FE0;">:ul</span> <span style="color: #858580;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"nav navbar-nav navbar-right"</span><span style="color: #858580;">}</span>
       <span style="color: #858580;">[</span><span style="color: #006FE0;">:li</span> <span style="color: #80A880;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"inactive"</span><span style="color: #80A880;">}</span> <span style="color: #80A880;">(</span>link-to <span style="color: #008000;">"/"</span> <span style="color: #008000;">"Science"</span><span style="color: #80A880;">)</span><span style="color: #858580;">]</span>
       <span style="color: #858580;">[</span><span style="color: #006FE0;">:li</span> <span style="color: #80A880;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"inactive"</span><span style="color: #80A880;">}</span> <span style="color: #80A880;">(</span>link-to <span style="color: #008000;">"/"</span> <span style="color: #008000;">"Programming"</span><span style="color: #80A880;">)</span><span style="color: #858580;">]</span>
       <span style="color: #858580;">[</span><span style="color: #006FE0;">:li</span> <span style="color: #80A880;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"inactive"</span><span style="color: #80A880;">}</span> <span style="color: #80A880;">(</span>link-to <span style="color: #008000;">"/"</span> <span style="color: #008000;">"About"</span><span style="color: #80A880;">)</span><span style="color: #858580;">]</span>
       <span style="color: #858580;">[</span><span style="color: #006FE0;">:li</span> <span style="color: #80A880;">[</span><span style="color: #006FE0;">:a</span> <span style="color: #887070;">{</span><span style="color: #006FE0;">:href</span> <span style="color: #008000;">"https://github.com/nkicg6"</span><span style="color: #887070;">}</span>
             <span style="color: #887070;">[</span><span style="color: #006FE0;">:span</span> <span style="color: #707183;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"fa fa-github"</span> <span style="color: #006FE0;">:style</span> <span style="color: #008000;">"font-size:24px"</span><span style="color: #707183;">}</span><span style="color: #887070;">]</span><span style="color: #80A880;">]</span><span style="color: #858580;">]</span>
       <span style="color: #858580;">[</span><span style="color: #006FE0;">:li</span> <span style="color: #80A880;">[</span><span style="color: #006FE0;">:a</span> <span style="color: #887070;">{</span><span style="color: #006FE0;">:href</span> <span style="color: #008000;">"https://twitter.com/NicholasMG"</span><span style="color: #887070;">}</span>
             <span style="color: #887070;">[</span><span style="color: #006FE0;">:span</span> <span style="color: #707183;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"fa fa-twitter-square"</span> <span style="color: #006FE0;">:style</span> <span style="color: #008000;">"font-size:24px"</span><span style="color: #707183;">}</span><span style="color: #887070;">]</span><span style="color: #80A880;">]</span><span style="color: #858580;">]</span><span style="color: #6276BA;">]</span><span style="color: #907373;">]</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:div.logo</span> <span style="color: #008000;">"website-clj"</span><span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:div.body</span> page<span style="color: #709870;">]</span>
    <span style="color: #709870;">[</span><span style="color: #006FE0;">:footer</span> <span style="color: #907373;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"footer"</span><span style="color: #907373;">}</span>
     <span style="color: #907373;">[</span><span style="color: #006FE0;">:div</span> <span style="color: #6276BA;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"text-center"</span><span style="color: #6276BA;">}</span>
      <span style="color: #6276BA;">[</span><span style="color: #006FE0;">:span</span> <span style="color: #858580;">{</span><span style="color: #006FE0;">:class</span> <span style="color: #008000;">"text-muted"</span><span style="color: #858580;">}</span> <span style="color: #008000;">"&amp;copy 2018 Nick George"</span><span style="color: #6276BA;">]</span><span style="color: #907373;">]</span><span style="color: #709870;">]</span><span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
I changed the section names and added dummy links for now, but the rest is a pretty straightforward translation. I am sure I am writing it in a non-compact way (i.e. it looks like classes under tags can be indicated as <code>.</code> attributes such as <code>[:div.logo "website-clj"]</code> expanding to <code>&lt;div class</code>"logo"&gt; "website-clj"&lt;/div&gt;), but this is working for me and it now renders like so:<br />
</p>


<div class="figure">
<p><img src="img/with-header-footer.png" alt="with-header-footer.png" /><br />
</p>
</div>
</div>
</div>

<div id="outline-container-org7dbb018" class="outline-3">
<h3 id="org7dbb018">org-workflow: basic HTML export</h3>
<div class="outline-text-3" id="text-org7dbb018">
<p>
<img src="file:///Users/Nick/personal_projects/website-clj/resources/public/img/org-mode-unicorn-logo.png" alt="org-mode-unicorn-logo.png" /><br />
   <a href="https://cjohansen.no/building-static-sites-in-clojure-with-stasis/">Christian Johanson's</a> excellent tutorial shows you how to build the site if you were to write your posts in markdown. However, as I wrote before, I write in emacs <a href="https://orgmode.org/">org-mode</a> markup and export to html. Org-mode provides excellent publishing and file export support (explained well in this <a href="https://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html">tutorial</a>), so I will use it to edit my files (if you want other reasons to use org-mode and understand why it has taken over my life, see <a href="https://www.youtube.com/watch?v=SzA2YODtgK4">this</a> video, and why it works great for reproducible research <a href="https://www.youtube.com/watch?v=1-dUkyn_fZA&amp;t=16s">here</a> and especially <a href="https://www.youtube.com/watch?v=CGnt_PWoM5Y&amp;t=89s">here</a>).<br />
The first step is to setup a directory in <code>resources</code> called org-posts that contains my org files. I will add a file to it called <code>test_post.org</code> that looks like so:<br />
</p>

<pre class="example">
#+OPTIONS: \n:1 toc:nil num:0 todo:nil ^:{}
#+HTML_CONTAINER: div



;* This is a test post

Here is a test post 




</pre>

<p>
Next, I will add the following to my <code>config.org</code> file (or <code>init.el</code> file if you arent using an org-mode config file) that says the following:<br />
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> org-publish-project-alist
        '(
          (<span style="color: #008000;">"posts"</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">name of this function</span>
           <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/personal_projects/website-clj/resources/org-posts"</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">where the orgs are</span>
           <span style="color: #006FE0;">:base-extension</span> <span style="color: #008000;">"org"</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">file ending to look for</span>
           <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/personal_projects/website-clj/resources/posts"</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">where to put the new one</span>
           <span style="color: #006FE0;">:publishing-function</span> org-html-publish-to-html <span style="color: #8D8D84;">;;</span><span style="color: #8D8D84; font-style: italic;">function to run</span>
           <span style="color: #006FE0;">:headline-levels</span> 4 <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">headline stuff</span>
           <span style="color: #006FE0;">:html-extension</span> <span style="color: #008000;">"html"</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">new file ending</span>
           <span style="color: #006FE0;">:body-only</span> t) <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">don't add extra html formatting</span>
          (<span style="color: #008000;">"clj-site"</span> <span style="color: #006FE0;">:components</span> (<span style="color: #008000;">"posts"</span>)))) <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">project name</span>
</pre>
</div>

<p>
Now, if i run <code>M-x org-publish-project</code> then select <code>clj-site</code>, I get a nicely exported html file in my <code>posts directory</code> <br />
</p>

<pre class="example">
resources/
├── home
│   └── index.html
├── md
│   └── my-first-md.md
├── org-posts
│   └── test_post.org
├── partials
│   └── about.html
├── posts
│   └── test_post.html
└── public
    ├── css
    ├── img
    │   └── test-img.png
    └── js

</pre>
<p>
Which is visible when I render the site (it is handled by the <code>html-posts</code> function)<br />
</p>
</div>
</div>

<div id="outline-container-orgc686904" class="outline-3">
<h3 id="orgc686904">Images and relative links</h3>
<div class="outline-text-3" id="text-orgc686904">
</div><div id="outline-container-org7a30a32" class="outline-4">
<h4 id="org7a30a32">Images</h4>
<div class="outline-text-4" id="text-org7a30a32">
<p>
Adding images is important to any site, and links too for that matter. How well do they work in this format?<br />
I'll start with a sample screenshot of my part of my landing page with an annotation.<br />
The first thing I did was make a new directory in my <code>resources/</code> directory called <code>public</code>, which will contain <code>img</code>, <code>css</code>, and <code>js</code> directories. The directory structure now looks like this:<br />
</p>
<pre class="example">
resources/
├── home
├── md
├── partials
├── posts
└── public
    ├── css
    ├── img
    └── js
</pre>

<p>
Now I will test it by adding a simple html tag for image to the source for my langing page.<br />
</p>

<pre class="example">
&lt;h1&gt;This is the landing page&lt;/h1&gt;
&lt;p&gt;
 Welcome to it.

Here is a test image:

 &lt;img src="../public/img/sample-img.png" alt="sample img!" /&gt;
&lt;/p&gt;

</pre>

<p>
This doesnt work. Changing the source to <code>&lt;img src ="sample-img.png"/&gt;</code> and copying the image to the same folder as the landing page doesn't help&#x2026;<br />
</p>
</div>

<div id="outline-container-orgca490da" class="outline-5">
<h5 id="orgca490da">Optimus</h5>
<div class="outline-text-5" id="text-orgca490da">
<p>
Christian Johansen's blog post uses <code>optimus</code> to wrap static folders. I'll start by trying to serve bootstrap locally rather than linking to the CDN.<br />
I played around with this for a few hours yesterday and couldn't figure it out. I understood things reasonably well until <code>Optimus</code>, which doesn't make much sense to me because I do not have a background in web development so I really cant understand what it is doing or why it is doing it. This is likely because I did not spend much time with the docs, but they use a lot of web-jargon and I don't have the time or will to jump into that now.<br />
</p>

<p>
     Luckily, I explored Christian Johansen's website a little more and came across something that seemed quite useful (<a href="https://cjohansen.no/optimized-optimus-asset-paths-clojurescript/">here</a>). But I didn't make much progress with this.<br />
&#x2026;<br />
Finally, after a few hours today I figured out how to add links. My directory structure now looks like so:<br />
</p>
<pre class="example">
resources/
├── home
├── md
├── org-posts
├── partials
├── posts
└── public
    ├── css
    ├── img
    └── js

</pre>
<p>
images can be added by referring to them relative to public. For example:<br />
</p>
<pre class="example">
[:div.test [:img {:src "/img/test-img.png"}]] ; img test in the hiccup function layout-base-header
</pre>

<p>
inserts the image stored in public/img/test-img.png<br />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org2da4c7c" class="outline-3">
<h3 id="org2da4c7c">org-workflow: Handling images</h3>
<div class="outline-text-3" id="text-org2da4c7c">
<p>
Back to my original org-export example file, I'll add an image in org-markup manner.<br />
</p>

<pre class="example">
#+OPTIONS: \n:1 toc:nil num:0 todo:nil ^:{}
#+HTML_CONTAINER: div



=* This is a test post
Here is a test post and a link to an image. 


[[file:~/personal_projects/website-clj/resources/public/img/test-img.png]]

</pre>

<p>
Exporting this to html gives the following link structure in HTML:<br />
</p>

<pre class="example">
&lt;img src="img/test-img.png" alt="test-img.png" /&gt;
</pre>

<p>
Which doesn't render properly wont work when I export the static site. Since all images are referred to <code>/img/</code>, I think I can easily write a string replace in Clojure and put it in my <code>html-posts</code> function to fix this formatting.<br />
<i>Note</i><br />
I know that I could use <a href="https://github.com/cgrand/enlive">enlive</a> to do pretty much the same thing, but with how my current workflow is, I dont think it is even necessary. I will add that in if I need to, but for now I just dont seem to need it.<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">main pages function. </span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #0000FF;">fn</span> <span style="color: #907373;">[</span>req<span style="color: #907373;">]</span> <span style="color: #907373;">(</span>layout-base-header req <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span>map #<span style="color: #907373;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">img"</span> <span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">/img"</span><span style="color: #907373;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this fixes links to images</span>
                    <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>


<p>
Now I can start up my server and check out the link formatting when I <code>view-source</code> on <code>http://localhost:3000/test_post</code>:<br />
</p>


<p>
<code>&lt;img src</code>"/img/test-img.png" alt="test-img.png" /&gt;=<br />
</p>

<p>
Perfect! I will factor out this function so it is more readable like so:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">format-images</span> <span style="color: #7388D6;">[</span>html<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> html #<span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">img"</span> <span style="color: #008000;">"src=</span><span style="color: #000000; font-weight: bold;">\"</span><span style="color: #008000;">/img"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">main pages function.</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">html-pages</span> <span style="color: #7388D6;">[</span>pages<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span>zipmap <span style="color: #909183;">(</span>map #<span style="color: #709870;">(</span><span style="color: #6434A3;">str</span><span style="color: #333333; background-color: #FFFFFF;">/</span><span style="color: #006FE0;">replace</span> <span style="color: #BA36A5;">%</span> #<span style="color: #008000;">"</span><span style="color: #000000; font-weight: bold;">\.</span><span style="color: #008000;">html$"</span> <span style="color: #008000;">""</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #006FE0;">keys</span> pages<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #006FE0;">map</span> #<span style="color: #709870;">(</span><span style="color: #0000FF;">fn</span> <span style="color: #907373;">[</span>req<span style="color: #907373;">]</span> <span style="color: #907373;">(</span>layout-base-header req <span style="color: #BA36A5;">%</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span><span style="color: #006FE0;">map</span> format-images <span style="color: #907373;">(</span><span style="color: #006FE0;">vals</span> pages<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

</pre>
</div>

<p>
I will likely need to add a similar helper when linking between pages in a post, but this <code>key value</code> handling of all the pages as simple html strings makes it very easy to add formatting fixes to my exported html pages. I am starting to feel the value and power of Clojure's emphasis on simplicity already&#x2013;very cool!<br />
</p>
</div>
</div>

<div id="outline-container-orgb0bc528" class="outline-3">
<h3 id="orgb0bc528">org-workflow: syntax highlighting</h3>
<div class="outline-text-3" id="text-orgb0bc528">
<p>
   <a href="https://cjohansen.no/building-static-sites-in-clojure-with-stasis/">Christian Johanson</a> has an excellent description of formatting markdown fenced code blocks with pygments for nice display on his static site. His approach uses pygments and enliven and is very detailed and nice. However, the amazing <code>org-mode</code> takes care of syntax highlighting for me when I add <code>(setq org-src-fontify-natively t)</code> to my <code>config.org</code>. So here I will just test it real quick and see how it looks.<br />
In my HTML file, I will add a clojure code block like so:<br />
</p>

<pre class="example">

#+OPTIONS: \n:1 toc:nil num:0 todo:nil ^:{}
#+HTML_CONTAINER: div




;* This is a test post
Here is a test post and a link to an image. 


[[file:~/personal_projects/website-clj/resources/public/img/test-img.png]]

And below is a test code block. 

#+BEGIN_SRC clojure 
(defn format-images [html]
  (str/replace html #"file:///Users/Nick/personal_projects/website-clj/resources/public" ""))

;; main pages function.
(defn html-pages [pages]
  (zipmap (map #(str/replace % #"\.html$" "") (keys pages))
          (map #(fn [req] (layout-base-header req %))
               (map format-images (vals pages)))))

#+END_SRC

How does it look?

</pre>

<p>
This renders upon <code>M-x org-publish-project clj-site</code> to look like this:<br />
</p>


<div class="figure">
<p><img src="img/syntax-highlighting.png" alt="syntax-highlighting.png" /><br />
</p>
</div>

<p>
<code>org-src-fontify-natively</code> uses the currently active theme to highlight your source code. I just exported this using the <a href="https://github.com/fniessen/emacs-leuven-theme">Leuven theme</a> (great for org-mode) and I like the way it looks. However, if I wanted to change it and use <code>enliven</code> with <code>pygments</code>, I would probably use some emacs-lisp code and packages such as those described here: <a href="https://emacs.stackexchange.com/questions/31439/how-to-get-colored-syntax-highlighting-of-code-blocks-in-asynchronous-org-mode-e">https://emacs.stackexchange.com/questions/31439/how-to-get-colored-syntax-highlighting-of-code-blocks-in-asynchronous-org-mode-e</a> , but for right now I dont think this is necessary for me so I will go with the raw html formatting from org-export.<br />
</p>

<p>
At this point, I removed all the markdown file stuff from my project as I don't plan to write in markdown and I cleaned up some other stuff I probably wont use. You can see the source code for my project <a href="https://github.com/nkicg6/website-clj">here</a>, all the code that does any work is in the <code>web.clj</code> file.<br />
</p>
</div>

<div id="outline-container-org9ed2460" class="outline-4">
<h4 id="org9ed2460">Links</h4>
<div class="outline-text-4" id="text-org9ed2460">
<p>
Will update when I need it.<br />
use (link-to)<br />
</p>
</div>
</div>
</div>
<div id="outline-container-orgcd73e37" class="outline-3">
<h3 id="orgcd73e37">publishing</h3>
<div class="outline-text-3" id="text-orgcd73e37">
</div><div id="outline-container-orgc82ba68" class="outline-4">
<h4 id="orgc82ba68">Hosting on Github Pages</h4>
<div class="outline-text-4" id="text-orgc82ba68">
<p>
From <code>lein</code>, Christian gives some nice instructions, so I followed those to see how the export looks and it seems to work nicely. Now, I'd like put my website on-line and I hosted my previous site on Github Pages, so I need a few config things to occur on export.  The first is the <code>CNAME</code> file, for mapping your domain name to the github repo. A good practice is to empty the target directory before exporting (as Christian did in <code>(stasis/empy-directory!)</code>), and I didn't see any options to exclude certain files, so I added a shell command to part of the export command and placed my <code>CNAME</code> in the <code>resources directory</code>:<br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.web</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.assets</span> <span style="color: #006FE0;">:as</span> assets<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.export</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.link</span> <span style="color: #006FE0;">:as</span> link<span style="color: #909183;">]</span> 
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.optimizations</span> <span style="color: #006FE0;">:as</span> optimizations<span style="color: #909183;">]</span>      
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.prime</span> <span style="color: #006FE0;">:as</span> optimus<span style="color: #909183;">]</span>                    
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.strategies</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>serve-live-assets<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.java.io</span> <span style="color: #006FE0;">:as</span> io<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.java.shell</span> <span style="color: #006FE0;">:as</span> shell<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">shell commands from clojure</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.page</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html5<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.element</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">(</span>link-to image<span style="color: #709870;">)</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">&lt;-----snip-----&gt;</span>

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Christian's original:</span>
<span style="color: #8D8D84;">;;</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">(def export-dir "build")</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">(defn export []</span>
<span style="color: #8D8D84;">;;   </span><span style="color: #8D8D84; font-style: italic;">(let [assets (optimizations/all (get-assets) {})]</span>
<span style="color: #8D8D84;">;;     </span><span style="color: #8D8D84; font-style: italic;">(stasis/empty-directory! export-dir)</span>
<span style="color: #8D8D84;">;;     </span><span style="color: #8D8D84; font-style: italic;">(optimus.export/save-assets assets export-dir)</span>
<span style="color: #8D8D84;">;;     </span><span style="color: #8D8D84; font-style: italic;">(stasis/export-pages (get-pages) export-dir {</span><span style="color: #8D8D84; font-style: italic;">:optimus-assets</span><span style="color: #8D8D84; font-style: italic;"> assets})))</span>
<span style="color: #8D8D84;">;;   </span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">my edits to include the copy after export. </span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">cp-cname</span> <span style="color: #7388D6;">[</span>export-dir<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">shell</span><span style="color: #333333; background-color: #FFFFFF;">/</span>sh <span style="color: #008000;">"cp"</span> <span style="color: #008000;">"resources/CNAME"</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">str</span> export-dir <span style="color: #008000;">"/CNAME"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">export-dir</span> <span style="color: #036A07;">"build"</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">export</span> <span style="color: #7388D6;">[]</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let</span> <span style="color: #909183;">[</span>assets <span style="color: #709870;">(</span><span style="color: #6434A3;">optimizations</span><span style="color: #333333; background-color: #FFFFFF;">/</span>all <span style="color: #907373;">(</span>get-assets<span style="color: #907373;">)</span> <span style="color: #907373;">{}</span><span style="color: #709870;">)</span><span style="color: #909183;">]</span>
    <span style="color: #909183;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>empty-directory! export-dir<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #6434A3;">optimus.export</span><span style="color: #333333; background-color: #FFFFFF;">/</span>save-assets assets export-dir<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>export-pages <span style="color: #709870;">(</span>get-pages<span style="color: #709870;">)</span> export-dir <span style="color: #709870;">{</span><span style="color: #006FE0;">:optimus-assets</span> assets<span style="color: #709870;">}</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>cp-cname export-dir<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">after export, copy CNAME back to base. </span>

</pre>
</div>

<p>
Now I can keep CNAME where it is supposed to be the whole time. This seems hacky&#x2026; but it also works without me messing up the awesome stasis code.<br />
</p>

<p>
To host on github pages, you also need the static files to be in a repo all by themselves. No problem, since <code>target</code> is already on my <code>.gitignore</code> from my Leiningen project, I can add my static content subdirectory (<code>nickgeorge.net</code>) and start a new repo in there.<br />
Unfortunately, with the previously mentioned problems with <code>(stasis/empty-directory!)</code>, my <code>.git</code> repo is deleted with every <code>lein build-site</code>. Looking in the <a href="https://github.com/magnars/stasis">Stasis code</a>, there doesn't seem to be a way to leave certain files in the target directory alone (There was with my Python Flask setup&#x2026;) while this may be a good and relatively easy way to contribute to the library, for now I am going to do a very horribly inefficient thing and copy the <code>.git</code> directory to a safe space, then back after export. I'll have to do the same with the <code>.gitignore</code><br />
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #0000FF;">ns</span> <span style="color: #6434A3;">website-clj.web</span>
  <span style="color: #7388D6;">(</span><span style="color: #006FE0;">:require</span> <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.assets</span> <span style="color: #006FE0;">:as</span> assets<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.export</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.link</span> <span style="color: #006FE0;">:as</span> link<span style="color: #909183;">]</span> 
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.optimizations</span> <span style="color: #006FE0;">:as</span> optimizations<span style="color: #909183;">]</span>      
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.prime</span> <span style="color: #006FE0;">:as</span> optimus<span style="color: #909183;">]</span>                    
            <span style="color: #909183;">[</span><span style="color: #6434A3;">optimus.strategies</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>serve-live-assets<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.java.io</span> <span style="color: #006FE0;">:as</span> io<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.java.shell</span> <span style="color: #006FE0;">:as</span> shell<span style="color: #909183;">]</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">shell commands from clojure</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">clojure.string</span> <span style="color: #006FE0;">:as</span> str<span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.page</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">[</span>html5<span style="color: #709870;">]</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">hiccup.element</span> <span style="color: #006FE0;">:refer</span> <span style="color: #709870;">(</span>link-to image<span style="color: #709870;">)</span><span style="color: #909183;">]</span>
            <span style="color: #909183;">[</span><span style="color: #6434A3;">stasis.core</span> <span style="color: #006FE0;">:as</span> stasis<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">&lt;-----snip-----&gt;</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">export-dir</span> <span style="color: #036A07;">"target/nickgeorge.net"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">def</span> <span style="color: #BA36A5;">safe-dir</span> <span style="color: #036A07;">"target"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">cp-cname</span> <span style="color: #7388D6;">[</span>export-dir<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">shell</span><span style="color: #333333; background-color: #FFFFFF;">/</span>sh <span style="color: #008000;">"cp"</span> <span style="color: #008000;">"resources/CNAME"</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">str</span> export-dir <span style="color: #008000;">"/CNAME"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">cp-gitignore</span> <span style="color: #7388D6;">[</span>export-dir<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">shell</span><span style="color: #333333; background-color: #FFFFFF;">/</span>sh <span style="color: #008000;">"cp"</span> <span style="color: #008000;">"target/.gitignore"</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">str</span> export-dir <span style="color: #008000;">"/.gitignore"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">save-git</span> <span style="color: #7388D6;">[</span>safe-dir export-dir<span style="color: #7388D6;">]</span> 
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">shell</span><span style="color: #333333; background-color: #FFFFFF;">/</span>sh <span style="color: #008000;">"mv"</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">str</span> export-dir <span style="color: #008000;">"/.git"</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">str</span> safe-dir <span style="color: #008000;">"/.git"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">replace-git</span> <span style="color: #7388D6;">[</span>safe-dir export-dir<span style="color: #7388D6;">]</span>
  <span style="color: #7388D6;">(</span><span style="color: #6434A3;">shell</span><span style="color: #333333; background-color: #FFFFFF;">/</span>sh <span style="color: #008000;">"mv"</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">str</span> safe-dir <span style="color: #008000;">"/.git"</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span><span style="color: #006FE0;">str</span> export-dir <span style="color: #008000;">"/.git"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">defn</span> <span style="color: #006699;">export</span> <span style="color: #7388D6;">[]</span>
  <span style="color: #7388D6;">(</span>save-git safe-dir export-dir<span style="color: #7388D6;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">copy .git to a safe place</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let</span> <span style="color: #909183;">[</span>assets <span style="color: #709870;">(</span><span style="color: #6434A3;">optimizations</span><span style="color: #333333; background-color: #FFFFFF;">/</span>all <span style="color: #907373;">(</span>get-assets<span style="color: #907373;">)</span> <span style="color: #907373;">{}</span><span style="color: #709870;">)</span><span style="color: #909183;">]</span>
    <span style="color: #909183;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>empty-directory! export-dir<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #6434A3;">optimus.export</span><span style="color: #333333; background-color: #FFFFFF;">/</span>save-assets assets export-dir<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #6434A3;">stasis</span><span style="color: #333333; background-color: #FFFFFF;">/</span>export-pages <span style="color: #709870;">(</span>get-pages<span style="color: #709870;">)</span> export-dir <span style="color: #709870;">{</span><span style="color: #006FE0;">:optimus-assets</span> assets<span style="color: #709870;">}</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>cp-cname export-dir<span style="color: #7388D6;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">preserve CNAME</span>
  <span style="color: #7388D6;">(</span>cp-gitignore export-dir<span style="color: #7388D6;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Put .gitignore in</span>
  <span style="color: #7388D6;">(</span>replace-git safe-dir export-dir<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">put .git back</span>

</pre>
</div>
</div>
</div>


<div id="outline-container-orgc528355" class="outline-4">
<h4 id="orgc528355">one push publishing with Leiningen :alias</h4>
<div class="outline-text-4" id="text-orgc528355">
<p>
I can already build my website with my current alias, now I will make another to deploy!<br />
The steps I need to do are:<br />
</p>
<ol class="org-ol">
<li>Command line build org-project<br />
<ul class="org-ul">
<li><code>org-publish-project clj-site</code> from the command line<br /></li>
<li>remember to add a header to tell org to <i>not</i> evaluate code like this: <code>#+PROPERTY: header-args :eval never-export</code><br /></li>
<li>This should be a clojure function called with <code>export</code> from <code>build-site</code> <br /></li>
</ul></li>
<li>Then run build-site<br /></li>
<li><code>git add</code> and <code>git push</code> all changes.<br />
<ul class="org-ul">
<li>This could also be a clojure function called with <code>export</code> from <code>build-site</code> <br /></li>
</ul></li>
</ol>

<p>
The idea is that I just call build-site and it all happens automatically. I will adopt Christian's tests as well though.<br />
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-org2344fef" class="outline-2">
<h2 id="org2344fef">References</h2>
<div class="outline-text-2" id="text-org2344fef">
<ul class="org-ul">
<li><a href="https://github.com/magnars/stasis">Stasis</a><br /></li>
<li><a href="https://github.com/magnars/optimus">Optimus links</a><br /></li>
<li><a href="https://github.com/ring-clojure/ring/wiki/Static-Resources">Ring static middleware</a><br /></li>
<li><a href="https://github.com/yokolet/hiccup-samples">hiccup samples</a><br /></li>
<li>Christian Johansen's post on Building static sites in Clojure with Stasis <a href="https://cjohansen.no/building-static-sites-in-clojure-with-stasis/">https://cjohansen.no/building-static-sites-in-clojure-with-stasis/</a><br />
<ul class="org-ul">
<li>handling links <a href="https://cjohansen.no/optimized-optimus-asset-paths-clojurescript/">https://cjohansen.no/optimized-optimus-asset-paths-clojurescript/</a><br /></li>
<li>Also his post here is similar with some (useful) differences <a href="https://github.com/cjohansen/cjohansen-no/blob/master/resources/md/building-static-sites-in-clojure-with-stasis.md">https://github.com/cjohansen/cjohansen-no/blob/master/resources/md/building-static-sites-in-clojure-with-stasis.md</a><br /></li>
</ul></li>
<li><a href="https://8thlight.com/blog/colin-jones/2010/12/05/clojure-libs-and-namespaces-require-use-import-and-ns.html">Clojure namespaces</a><br /></li>
<li>add more org-mode links!<br /></li>
</ul>
</div>
</div>
